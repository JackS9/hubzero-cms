/*
		GNU General Public License version 2 or later; see LICENSE.txt
*/
var JFormValidator=function(){this.initialize=function(){this.handlers=Object();this.custom=Object();this.setHandler('username',function(value){regex=new RegExp("[\<|\>|\"|\'|\%|\;|\(|\)|\&]","i");return!regex.test(value)});this.setHandler('password',function(value){regex=/^\S[\S ]{2,98}\S$/;return regex.test(value)});this.setHandler('numeric',function(value){regex=/^(\d|-)?(\d|,)*\.?\d*$/;return regex.test(value)});this.setHandler('email',function(value){regex=/^[a-zA-Z0-9._-]+(\+[a-zA-Z0-9._-]+)*@([a-zA-Z0-9.-]+\.)+[a-zA-Z0-9.-]{2,4}$/;return regex.test(value)});var forms=$$('form.form-validate');forms.each(function(form){this.attachToForm(form)},this)};this.setHandler=function(name,fn,en){en=(en=='')?true:en;this.handlers[name]={enabled:en,exec:fn}};this.attachToForm=function(form){form.find('input,textarea,select,button').each(function(i,el){el=$(el);if(el.hasClass('required')){el.attr('aria-required','true');el.attr('required','required')}if((el.prop('tagName')=='input'||$(el).prop('tagName')=='button')&&$(el).attr('type')=='submit'){if(el.hasClass('validate')){el.on('click',function(){return document.formvalidator.isValid(this.form)})}}else{el.on('blur',function(){return document.formvalidator.validate(this)});if(el.hasClass('validate-email')&&this.inputemail){el.attr('type')='email'}}})};this.inputemail=function(){var i=document.createElement("input");i.setAttribute("type","email");return i.type!=="text"};this.validate=function(el){el=$(el);if(el.attr('disabled')&&!(el.hasClass('required'))){this.handleResponse(true,el);return true}if(el.hasClass('required')){if(el.prop('tagName')=='fieldset'&&(el.hasClass('radio')||el.hasClass('checkboxes'))){for(var i=0;i++){if($(el.attr('id')+i)){if($(el.attr('id')+i).checked){break}}else{this.handleResponse(false,el);return false}}}else if(!(el.val())){this.handleResponse(false,el);return false}}var handler=(el.className&&el.className.search(/validate-([a-zA-Z0-9\_\-]+)/)!=-1)?el.className.match(/validate-([a-zA-Z0-9\_\-]+)/)[1]:"";if(handler==''){this.handleResponse(true,el);return true}if((handler)&&(handler!='none')&&(this.handlers[handler])&&el.get('value')){if(this.handlers[handler].exec(el.get('value'))!=true){this.handleResponse(false,el);return false}}this.handleResponse(true,el);return true};this.isValid=function(form){var valid=true;var elements=form.find('fieldset').concat(Array.from(form.elements));for(var i=0;i<elements.length;i++){if(this.validate(elements[i])==false){valid=false}}new Hash(this.custom).each(function(validator){if(validator.exec()!=true){valid=false}});return valid};this.handleResponse=function(state,el){if(!(el.labelref)){var labels=$$('label');labels.each(function(label){if(label.get('for')==el.get('id')){el.labelref=label}})}if(state==false){el.addClass('invalid');el.attr('aria-invalid','true');if(el.labelref){$(el.labelref).addClass('invalid');$(el.labelref).attr('aria-invalid','true')}}else{el.removeClass('invalid');el.attr('aria-invalid','false');if(el.labelref){$(el.labelref).removeClass('invalid');$(el.labelref).attr('aria-invalid','false')}}}};document.formvalidator=null;jQuery(document).ready(function($){document.formvalidator=new JFormValidator()});